<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç§»å·¥è­°é¡ŒåŠ‡æœ¬è¼”åŠ©ç³»çµ±</title>
    <!-- å¼•å…¥ Tailwind CSS é€²è¡Œæ’ç‰ˆ -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- å¼•å…¥ Google Fonts å­—å‹ -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700;900&family=Noto+Serif+TC:wght@600;900&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Noto Sans TC', sans-serif;
            background-color: #f8fafc;
        }
        .serif {
            font-family: 'Noto Serif TC', serif;
        }
        .role-card {
            transition: all 0.3s ease;
            cursor: pointer;
        }
        .role-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
        }
        .nav-btn.active {
            background-color: #2563eb;
            color: white;
            border-bottom: 4px solid #1e40af;
        }
        .nav-btn {
            background-color: white;
            color: #4b5563;
            border-bottom: 4px solid transparent;
            transition: all 0.2s;
        }
        .nav-btn:hover:not(.active) {
            background-color: #f1f5f9;
        }
        .loader {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #3b82f6;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        /* æ’­æ”¾æŒ‰éˆ•å‹•ç•« */
        button.playing svg {
            fill: #16a34a;
            color: #16a34a;
        }
    </style>
</head>
<body class="min-h-screen flex flex-col">

    <!-- å°èˆªåˆ— -->
    <nav class="bg-white shadow-md sticky top-0 z-40">
        <div class="max-w-6xl mx-auto px-4">
            <div class="flex flex-col md:flex-row justify-between items-center md:h-16 py-2 md:py-0">
                <div class="flex items-center justify-between w-full md:w-auto">
                    <div class="font-black text-xl text-gray-800 tracking-tight mb-2 md:mb-0 mr-4">ç¤¾æœƒè¦ç¯„æ¢ç©¶å·¥ä½œå°</div>
                    
                    <!-- æ‰‹æ©Ÿç‰ˆè¨­å®šæŒ‰éˆ• (éš±è—ï¼Œå› ç‚ºå·²å…§å»º Key) -->
                    <button onclick="openSettings()" class="md:hidden text-gray-400 hover:text-blue-600 p-2 opacity-50">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6"><path stroke-linecap="round" stroke-linejoin="round" d="M10.34 15.84c-.688-.06-1.386-.09-2.09-.09H7.5a4.5 4.5 0 110-9h.75c.704 0 1.402-.03 2.09-.09m0 9.18c.253.962.584 1.892.985 2.783.247.55.06 1.21-.463 1.511l-.657.38c-.551.318-1.26.117-1.527-.461a20.845 20.845 0 01-1.44-4.282m3.102.069a18.03 18.03 0 01-.59-4.59c0-1.586.205-3.124.59-4.59m0 9.18a23.848 23.848 0 018.835 2.535M10.34 6.66a23.847 23.847 0 008.835-2.535m0 0A23.74 23.74 0 0018.795 3m.38 1.125a23.91 23.91 0 011.014 5.395m-1.014 8.855c-.118.38-.245.754-.38 1.125m.38-1.125a23.91 23.91 0 001.014-5.395m0-3.46c.495.439.875 1.116.875 1.734v3.458c0 .618-.38 1.295-.875 1.734m0-6.926a23.91 23.91 0 01-1.014-5.395m0 8.855a23.91 23.91 0 00-1.014 5.395" /></svg>
                    </button>
                </div>
                
                <div class="flex items-center space-x-2 md:space-x-4 w-full md:w-auto justify-between md:justify-end overflow-x-auto">
                    <button onclick="switchPage('page1')" id="btn-page1" class="nav-btn active px-3 md:px-6 py-2 rounded-t-lg font-bold text-sm md:text-lg flex items-center whitespace-nowrap">
                        <span class="bg-blue-100 text-blue-800 text-xs px-2 py-0.5 rounded mr-2 hidden md:inline">STEP 1</span>
                        è¨ªå•äººå£«
                    </button>
                    <button onclick="switchPage('page2')" id="btn-page2" class="nav-btn px-3 md:px-6 py-2 rounded-t-lg font-bold text-sm md:text-lg flex items-center whitespace-nowrap">
                        <span class="bg-red-100 text-red-800 text-xs px-2 py-0.5 rounded mr-2 hidden md:inline">STEP 2</span>
                        çªç™¼å¿«è¨Š
                    </button>
                    <button onclick="switchPage('page3')" id="btn-page3" class="nav-btn px-3 md:px-6 py-2 rounded-t-lg font-bold text-sm md:text-lg flex items-center whitespace-nowrap">
                        <span class="bg-green-100 text-green-800 text-xs px-2 py-0.5 rounded mr-2 hidden md:inline">STEP 3</span>
                        å…¬è½æœƒ
                    </button>
                    
                    <!-- é›»è…¦ç‰ˆè¨­å®šæŒ‰éˆ• (éš±è—) -->
                    <button onclick="openSettings()" class="hidden md:flex items-center text-gray-400 hover:text-blue-600 transition-colors ml-2 opacity-50" title="API Key è¨­å®š (å·²å…§å»º)">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6"><path stroke-linecap="round" stroke-linejoin="round" d="M10.34 15.84c-.688-.06-1.386-.09-2.09-.09H7.5a4.5 4.5 0 110-9h.75c.704 0 1.402-.03 2.09-.09m0 9.18c.253.962.584 1.892.985 2.783.247.55.06 1.21-.463 1.511l-.657.38c-.551.318-1.26.117-1.527-.461a20.845 20.845 0 01-1.44-4.282m3.102.069a18.03 18.03 0 01-.59-4.59c0-1.586.205-3.124.59-4.59m0 9.18a23.848 23.848 0 018.835 2.535M10.34 6.66a23.847 23.847 0 008.835-2.535m0 0A23.74 23.74 0 0018.795 3m.38 1.125a23.91 23.91 0 011.014 5.395m-1.014 8.855c-.118.38-.245.754-.38 1.125m.38-1.125a23.91 23.91 0 001.014-5.395m0-3.46c.495.439.875 1.116.875 1.734v3.458c0 .618-.38 1.295-.875 1.734m0-6.926a23.91 23.91 0 01-1.014-5.395m0 8.855a23.91 23.91 0 00-1.014 5.395" /></svg>
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <div class="max-w-6xl mx-auto p-4 md:p-8 w-full flex-grow">

        <header class="text-center mb-10">
            <h1 class="text-3xl md:text-4xl font-black text-gray-900 mb-2 leading-normal">ã€Œç§»å·¥å®‰å¿ƒé†«ç™‚å¡ã€<br class="md:hidden">è©¦è¾¦å…¬è½æœƒ</h1>
            <p class="text-gray-600">é‹ç”¨è³‡æ–™åº«èˆ‡è§’è‰²å°è©±ï¼Œå®Œæˆä½ çš„å”å•†åŠ‡æœ¬</p>
        </header>

        <!-- PAGE 1: è¨ªå•ç›¸é—œäººå£« -->
        <div id="page1" class="page-content">
            <div class="bg-blue-50 border-l-4 border-blue-600 p-4 mb-8 rounded-r-lg shadow-sm">
                <h3 class="font-bold text-blue-900 text-lg mb-1">ğŸ“¢ ä»»å‹™èªªæ˜</h3>
                <p class="text-blue-800">
                    é»æ“Šä¸‹æ–¹è§’è‰²å¡ç‰‡ï¼Œå³å¯èˆ‡è©²è§’è‰²å°è©±ã€‚ä½ å¯ä»¥è©¢å•ä»–å€‘å°æ–¼ã€Œå…«ä»½èƒŒæ™¯è³‡æ–™ã€çš„çœ‹æ³•ï¼Œæˆ–æ˜¯è«‹æ•™ä»–å€‘åœ¨å…¬è½æœƒä¸­çš„ç«‹å ´ã€‚<br>
                    <span class="text-sm opacity-80">*AI è§’è‰²å°‡ä¾æ“šè³‡æ–™åº«å›ç­”ï¼Œä½†ä¸æœƒç›´æ¥å¹«ä½ å¯«å‡ºåŠ‡æœ¬å°è©ã€‚</span>
                </p>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                <!-- è§’è‰² 1 -->
                <div onclick="openInterview('è¶Šå—å¯†é†« èŒƒé†«å¸«', 'è¶Šå—é†«å¸«åˆ°å°ç£åšæ¸…æ½”å·¥ï¼Œé•æ³•å¹«å¤–ç±ç§»å·¥é€²è¡Œé†«ç™‚ã€‚', 'bg-slate-100')" class="role-card bg-white p-6 rounded-xl shadow-sm border border-gray-200 flex flex-col items-center text-center group h-full">
                    <div class="w-20 h-20 bg-orange-100 rounded-full mb-4 flex items-center justify-center text-4xl shadow-inner">ğŸ©º</div>
                    <h3 class="font-bold text-xl text-gray-900 mb-2">è¶Šå—å¯†é†« èŒƒé†«å¸«</h3>
                    <p class="text-sm text-gray-500 leading-relaxed flex-grow">è¶Šå—é†«å¸«åˆ°å°ç£åšæ¸…æ½”å·¥<br>é•æ³•å¹«å¤–ç±ç§»å·¥é€²è¡Œé†«ç™‚</p>
                    <button class="mt-4 w-full text-blue-600 font-bold text-sm bg-blue-50 px-4 py-2 rounded-lg group-hover:bg-blue-600 group-hover:text-white transition-colors">é–‹å§‹å°è©±</button>
                </div>
                <!-- è§’è‰² 2 -->
                <div onclick="openInterview('å¤±è¯ç§»å·¥ é˜¿é€¸', 'å·¥å‚·å»ä¸æ•¢å°±é†«çš„é€ƒè·‘ç§»å·¥ï¼Œä¾é ç¤¾å·¥èˆ‡ç¤¾æœƒè³‡æºå”åŠ©ã€‚', 'bg-slate-100')" class="role-card bg-white p-6 rounded-xl shadow-sm border border-gray-200 flex flex-col items-center text-center group h-full">
                    <div class="w-20 h-20 bg-orange-100 rounded-full mb-4 flex items-center justify-center text-4xl shadow-inner">ğŸ¤•</div>
                    <h3 class="font-bold text-xl text-gray-900 mb-2">å¤±è¯ç§»å·¥ é˜¿é€¸</h3>
                    <p class="text-sm text-gray-500 leading-relaxed flex-grow">å·¥å‚·å»ä¸æ•¢å°±é†«çš„é€ƒè·‘ç§»å·¥<br>ä¾é ç¤¾å·¥èˆ‡ç¤¾æœƒè³‡æºå”åŠ©</p>
                    <button class="mt-4 w-full text-blue-600 font-bold text-sm bg-blue-50 px-4 py-2 rounded-lg group-hover:bg-blue-600 group-hover:text-white transition-colors">é–‹å§‹å°è©±</button>
                </div>
                <!-- è§’è‰² 3 -->
                <div onclick="openInterview('å¸‚ç«‹é†«é™¢ é™¢é•·', 'åŒæ™‚é¢å°è¨ºé–“å…§é‡å‚·çš„é€ƒè·‘ç§»å·¥ï¼ŒåŠæœªè¢«ä»˜æ¸…çš„é¾å¤§å‘†å¸³ã€‚', 'bg-slate-100')" class="role-card bg-white p-6 rounded-xl shadow-sm border border-gray-200 flex flex-col items-center text-center group h-full">
                    <div class="w-20 h-20 bg-orange-100 rounded-full mb-4 flex items-center justify-center text-4xl shadow-inner">ğŸ¥</div>
                    <h3 class="font-bold text-xl text-gray-900 mb-2">å¸‚ç«‹é†«é™¢ é™¢é•·</h3>
                    <p class="text-sm text-gray-500 leading-relaxed flex-grow">åŒæ™‚é¢å°è¨ºé–“å…§é‡å‚·çš„é€ƒè·‘ç§»å·¥<br>åŠæœªè¢«ä»˜æ¸…çš„é¾å¤§å‘†å¸³</p>
                    <button class="mt-4 w-full text-blue-600 font-bold text-sm bg-blue-50 px-4 py-2 rounded-lg group-hover:bg-blue-600 group-hover:text-white transition-colors">é–‹å§‹å°è©±</button>
                </div>
                <!-- è§’è‰² 4 -->
                <div onclick="openInterview('å®¶åº­ç…§è­·é›‡ä¸»', 'ä¾ç…§åˆæ³•ç¨‹åºé›‡ç”¨å¤–ç±ç§»å·¥ï¼Œç…§é¡§å®¶ä¸­å‚·ç—…é•·è¼©ã€‚', 'bg-slate-100')" class="role-card bg-white p-6 rounded-xl shadow-sm border border-gray-200 flex flex-col items-center text-center group h-full">
                    <div class="w-20 h-20 bg-orange-100 rounded-full mb-4 flex items-center justify-center text-4xl shadow-inner">ğŸ‘µ</div>
                    <h3 class="font-bold text-xl text-gray-900 mb-2">å®¶åº­ç…§è­·é›‡ä¸»</h3>
                    <p class="text-sm text-gray-500 leading-relaxed flex-grow">ä¾ç…§åˆæ³•ç¨‹åºé›‡ç”¨å¤–ç±ç§»å·¥<br>ç…§é¡§å®¶ä¸­å‚·ç—…é•·è¼©</p>
                    <button class="mt-4 w-full text-blue-600 font-bold text-sm bg-blue-50 px-4 py-2 rounded-lg group-hover:bg-blue-600 group-hover:text-white transition-colors">é–‹å§‹å°è©±</button>
                </div>
                <!-- è§’è‰² 5 -->
                <div onclick="openInterview('ç«‹æ³•å§”å“¡ è˜‡ç«‹å§”', 'è³ªè©¢å‹å‹•éƒ¨é•·æ™‚ï¼Œæå‡ºã€Œè‡ºç£äººæ€æœƒå¹«å¤–ç±æ¼å·¥é€uberã€çš„ç™¼ç¾ã€‚', 'bg-slate-100')" class="role-card bg-white p-6 rounded-xl shadow-sm border border-gray-200 flex flex-col items-center text-center group h-full">
                    <div class="w-20 h-20 bg-orange-100 rounded-full mb-4 flex items-center justify-center text-4xl shadow-inner">ğŸ¤</div>
                    <h3 class="font-bold text-xl text-gray-900 mb-2">ç«‹æ³•å§”å“¡ è˜‡ç«‹å§”</h3>
                    <p class="text-sm text-gray-500 leading-relaxed flex-grow">è³ªè©¢å‹å‹•éƒ¨é•·æ™‚ï¼Œæå‡º<br>ã€Œè‡ºç£äººæ€æœƒå¹«å¤–ç±æ¼å·¥é€uberã€çš„ç™¼ç¾</p>
                    <button class="mt-4 w-full text-blue-600 font-bold text-sm bg-blue-50 px-4 py-2 rounded-lg group-hover:bg-blue-600 group-hover:text-white transition-colors">é–‹å§‹å°è©±</button>
                </div>
                <!-- è§’è‰² 6 -->
                <div onclick="openInterview('å‚³çµ±å·¥å» è€é—†', 'ä»¥è¼ƒé«˜è–ªæ°´ç§ä¸‹é›‡ç”¨é€ƒè·‘ç§»å·¥ï¼Œä½†å‹å·¥ç„¡æ³•ä½¿ç”¨å‹å¥ä¿ã€‚', 'bg-slate-100')" class="role-card bg-white p-6 rounded-xl shadow-sm border border-gray-200 flex flex-col items-center text-center group h-full">
                    <div class="w-20 h-20 bg-orange-100 rounded-full mb-4 flex items-center justify-center text-4xl shadow-inner">ğŸ­</div>
                    <h3 class="font-bold text-xl text-gray-900 mb-2">å‚³çµ±å·¥å» è€é—†</h3>
                    <p class="text-sm text-gray-500 leading-relaxed flex-grow">ä»¥è¼ƒé«˜è–ªæ°´ç§ä¸‹é›‡ç”¨é€ƒè·‘ç§»å·¥<br>ä½†å‹å·¥ç„¡æ³•ä½¿ç”¨å‹å¥ä¿</p>
                    <button class="mt-4 w-full text-blue-600 font-bold text-sm bg-blue-50 px-4 py-2 rounded-lg group-hover:bg-blue-600 group-hover:text-white transition-colors">é–‹å§‹å°è©±</button>
                </div>
                <!-- è§’è‰² 7 -->
                <div onclick="openInterview('è‡ºç£Uberå¤–é€å“¡', 'æ“”å¿ƒè¶Šä¾†è¶Šå¤šå¤–ç±ç§»å·¥å’Œè‡ªå·±ä¸€æ¨£è·‘å¤–é€ã€‚', 'bg-slate-100')" class="role-card bg-white p-6 rounded-xl shadow-sm border border-gray-200 flex flex-col items-center text-center group h-full">
                    <div class="w-20 h-20 bg-orange-100 rounded-full mb-4 flex items-center justify-center text-4xl shadow-inner">ğŸ›µ</div>
                    <h3 class="font-bold text-xl text-gray-900 mb-2">è‡ºç£Uberå¤–é€å“¡</h3>
                    <p class="text-sm text-gray-500 leading-relaxed flex-grow">æ“”å¿ƒè¶Šä¾†è¶Šå¤šå¤–ç±ç§»å·¥<br>å’Œè‡ªå·±ä¸€æ¨£è·‘å¤–é€</p>
                    <button class="mt-4 w-full text-blue-600 font-bold text-sm bg-blue-50 px-4 py-2 rounded-lg group-hover:bg-blue-600 group-hover:text-white transition-colors">é–‹å§‹å°è©±</button>
                </div>
                <!-- è§’è‰² 8 -->
                <div onclick="openInterview('å‹å‹•éƒ¨é•·', 'åš´æ ¼åŸ·è¡Œã€Šå‹åŸºæ³•ã€‹å’Œã€Šå°±æ¥­æœå‹™æ³•ã€‹è¦å®šã€‚', 'bg-slate-100')" class="role-card bg-white p-6 rounded-xl shadow-sm border border-gray-200 flex flex-col items-center text-center group h-full">
                    <div class="w-20 h-20 bg-orange-100 rounded-full mb-4 flex items-center justify-center text-4xl shadow-inner">âš–ï¸</div>
                    <h3 class="font-bold text-xl text-gray-900 mb-2">å‹å‹•éƒ¨é•·</h3>
                    <p class="text-sm text-gray-500 leading-relaxed flex-grow">åš´æ ¼åŸ·è¡Œã€Šå‹åŸºæ³•ã€‹<br>å’Œã€Šå°±æ¥­æœå‹™æ³•ã€‹è¦å®š</p>
                    <button class="mt-4 w-full text-blue-600 font-bold text-sm bg-blue-50 px-4 py-2 rounded-lg group-hover:bg-blue-600 group-hover:text-white transition-colors">é–‹å§‹å°è©±</button>
                </div>
            </div>
        </div>

        <!-- PAGE 2: çªç™¼æ–°èå¿«è¨Š -->
        <div id="page2" class="page-content hidden">
            <div class="bg-red-50 border-l-4 border-red-600 p-4 mb-8 rounded-r-lg shadow-sm">
                <h3 class="font-bold text-red-900 text-lg mb-1">ğŸ”¥ ç¿»å‹•æ€§è³‡æ–™ä»»å‹™</h3>
                <p class="text-red-800">
                    ç•¶åŠ‡æœ¬å¯«ä½œé€²è¡Œåˆ°ä¸€åŠï¼Œè€å¸«ç™¼ä¸‹é€™äº›ã€Œæ–°èå¡ã€æ™‚ï¼Œä½ å¯ä»¥é»æ“ŠæŒ‰éˆ•è©¢å•ç›¸é—œäººå£«çš„åæ‡‰ã€‚<br>
                    <strong>é€™äº›çœŸå¯¦æ–°èå°‡æœƒå¤§å¤§æ”¹è®ŠåŠ‡æœ¬çš„èµ°å‘ï¼</strong>
                </p>
            </div>

            <div class="space-y-8">
                <!-- å¡ç‰‡ 1 -->
                <div class="news-card bg-white border-t-8 border-red-600 p-8 rounded-lg shadow-md">
                    <div class="flex flex-col md:flex-row justify-between items-start mb-4">
                        <h3 class="text-2xl font-black text-gray-900 serif mb-2 md:mb-0 leading-normal">æ³•å®˜èªªã€Œæƒ…æœ‰å¯åŸã€ï¼<br>ç§»å·¥ç•¶å¯†é†«åˆ¤æ±ºå…é£è¿”</h3>
                        <span class="bg-red-100 text-red-800 text-xs px-3 py-1 rounded-full font-bold">ç¤¾æœƒç‰ˆ</span>
                    </div>
                    <!-- æ¢å¾©å®Œæ•´çš„æ½¤é£¾å…§å®¹ï¼Œå¼·èª¿é–±è®€æ€§ -->
                    <div class="prose text-gray-800 mb-6 border-l-4 border-gray-100 pl-4">
                        <p class="mb-2"><strong>ã€æœ¬å ±è¨Šã€‘</strong>é«˜é›„ç™¼ç”Ÿä¸€èµ·å¼•ç™¼ç†±è­°çš„åˆ¤æ±ºï¼æœ‰ä¸€ä½å°å°¼ç±å¥³ç§»å·¥ï¼Œå› ç‚ºåŒé„‰è¦ºå¾—åœ¨å°ç£çœ‹ç‰™é†«å¤ªè²´ã€èªè¨€åˆä¸é€šï¼Œæ‰€ä»¥å¥¹åœ¨é£¯åº—æˆ¿é–“å…§å¹«åŒé„‰æ´—ç‰™ã€æˆ´ç‰™å¥—ã€‚ç”Ÿæ„éå¸¸å¥½ï¼Œå¾Œä¾†è¢«è­¦æ–¹æŸ¥ç²ã€‚</p>
                        <p class="mb-2 bg-red-50 p-2 rounded text-red-900 font-bold">æ³•å®˜çš„é©šäººæ±ºå®šï¼šåˆ¤å¥¹ã€Œç·©åˆ‘ã€ï¼ˆä¸ç”¨çœŸçš„å»é—œï¼‰ï¼Œè€Œä¸”ã€Œä¸ç”¨è¢«é©…é€å‡ºå¢ƒã€ï¼</p>
                        <p class="mb-1 font-bold text-gray-900">æ³•å®˜çµ¦å‡ºçš„ä¸‰å€‹ç†ç”±ï¼š</p>
                        <ul class="list-disc pl-5 space-y-1 text-gray-700">
                            <li><strong>è²»ç”¨å¤ªé«˜ï¼š</strong>å¤§å®¶éƒ½çŸ¥é“çœ‹ç‰™é½’å¾ˆè²´ï¼Œå¾ˆå¤šé …ç›®å¥ä¿ä¸çµ¦ä»˜ã€‚ç§»å·¥è–ªæ°´å¾ˆä½ï¼ŒçœŸçš„ä»˜ä¸èµ·å»å¤§é†«é™¢çœ‹ç‰™çš„éŒ¢ã€‚</li>
                            <li><strong>è§£æ±ºå›°å¢ƒï¼š</strong>å¥¹é›–ç„¶é•æ³•ï¼Œä½†å¥¹å¹«é€™äº›çª®å›°çš„åŒé„‰è§£æ±ºäº†æ±‚é†«ç„¡é–€çš„å›°é›£ã€‚</li>
                            <li><strong>å½±éŸ¿æœ‰é™ï¼š</strong>å¥¹åªå¹«åŒé„‰çœ‹ç—…ï¼Œæ²’æœ‰å±å®³åˆ°å°ç£äººçš„å®‰å…¨ã€‚</li>
                        </ul>
                    </div>
                    <button onclick="openInterview('æ³•å®˜', 'é‡å°ç§»å·¥å¯†é†«æ¡ˆåšå‡ºä¸ç”¨é£è¿”çš„å¯¬å®¹åˆ¤æ±ºã€‚ç‰¹è³ªï¼šç†æ€§ã€çœ‹è¦‹çµæ§‹æ€§å•é¡Œã€‚é€™å‰‡æ–°èæœƒè®“èŒƒé†«å¸«æ„Ÿåˆ°é¼“èˆï¼Œè®“è˜‡ç«‹å§”æ„Ÿåˆ°æ†¤æ€’ã€‚', 'bg-red-600')" class="flex items-center space-x-2 bg-red-100 hover:bg-red-200 text-red-800 px-5 py-3 rounded-lg font-bold transition-colors w-full md:w-auto justify-center">
                        <span class="text-xl">ğŸ¤</span>
                        <span>è¨ªå•æ³•å®˜ï¼šç‚ºä»€éº¼é€™æ¨£åˆ¤ï¼Ÿ</span>
                    </button>
                </div>

                <!-- å¡ç‰‡ 2 -->
                <div class="news-card bg-white border-t-8 border-blue-600 p-8 rounded-lg shadow-md">
                    <div class="flex flex-col md:flex-row justify-between items-start mb-4">
                        <h3 class="text-2xl font-black text-gray-900 serif mb-2 md:mb-0 leading-normal">æ•‘äººè®Šè³ éŒ¢ï¼Ÿ<br>å°å¤§åé†«å–Šã€Œé†«é™¢ä¸æ˜¯åšåŠŸå¾·çš„ã€</h3>
                        <span class="bg-blue-100 text-blue-800 text-xs px-3 py-1 rounded-full font-bold">é†«ç™‚ç‰ˆ</span>
                    </div>
                    <!-- æ¢å¾©å®Œæ•´çš„æ½¤é£¾å…§å®¹ï¼Œå¼·èª¿é–±è®€æ€§ -->
                    <div class="prose text-gray-800 mb-6 border-l-4 border-gray-100 pl-4">
                        <p class="mb-2"><strong>ã€æœ¬å ±è¨Šã€‘</strong>é€ƒé€¸ç§»å·¥çœ‹ç—…æ²’éŒ¢ä»˜ï¼Œè®Šæˆé†«é™¢çš„çˆ›å¸³ï¼Ÿå°å¤§é†«é™¢è‘—åçš„å©¦ç”¢ç§‘é†«å¸«æ–½æ™¯ä¸­ï¼Œåˆ†äº«äº†ä¸€å€‹ç„¡å¥ˆçš„çœŸå¯¦æ¡ˆä¾‹ã€‚</p>
                        <div class="bg-blue-50 p-3 rounded mb-2 border border-blue-100">
                            <span class="font-black text-xl text-blue-900 block mb-1">142è¬å…ƒçš„é†«ç™‚è²»ï¼Œèª°ä»˜ï¼Ÿ</span>
                            <p class="text-blue-900 text-sm">æ–½é†«å¸«æ•‘äº†ä¸€ä½æƒ…æ³å±æ€¥çš„æ‡·å­•é€ƒé€¸ç§»å·¥ã€‚é›–ç„¶æ¯å­å¹³å®‰ï¼Œä½†å› ç‚ºå¥¹åœ¨åŠ è­·ç—…æˆ¿ä½äº†å¾ˆä¹…ï¼Œæœ€å¾Œçµå¸³æ™‚é†«ç™‚è²»é«˜é” <span class="text-red-600 font-bold text-xl">142 è¬å…ƒï¼</span></p>
                            <p class="text-blue-900 text-sm mt-1">åŸæœ¬æ‰¿è«¾å¹«å¿™çš„æ°‘é–“åœ˜é«”ï¼Œæœ€å¾Œåªæ‹¿å¾—å‡º 8 è¬å…ƒã€‚å‰©ä¸‹çš„ <strong>134 è¬å…ƒ</strong> å…¨éƒ¨è®Šæˆäº†é†«é™¢æ”¶ä¸å›ä¾†çš„ã€Œå‘†å¸³ã€ã€‚</p>
                        </div>
                        <p class="text-gray-700 mt-2"><strong>ğŸ‘¨â€âš•ï¸ é†«ç”Ÿçš„æ“”æ†‚</strong><br>æ–½é†«å¸«æ„Ÿå˜†ï¼šã€Œä»¥å‰ä»¥ç‚ºåªæ˜¯å¹¾è¬å¡Šï¼Œæ²’æƒ³åˆ°é‡ç—‡æ²»ç™‚é€™éº¼è²´ã€‚ã€é†«é™¢ä¹Ÿè¦ç™¼è–ªæ°´ã€è¦è²·è—¥ï¼Œå¦‚æœæ¯æ¬¡æ•‘äº†é€ƒé€¸ç§»å·¥éƒ½æ”¶ä¸åˆ°éŒ¢ï¼Œ<span class="bg-yellow-200 px-1 font-bold">é†«é™¢çœŸçš„æœƒæ’ä¸ä¸‹å»</span>ï¼Œæœ€å¾Œå—å®³çš„é‚„æ˜¯å…¨é«”çš„ç—…äººã€‚</p>
                    </div>
                    <button onclick="openInterview('æ–½æ™¯ä¸­é†«å¸«', 'å°å¤§å©¦ç”¢ç§‘åé†«ã€‚é¢å°é‰…é¡å‘†å¸³æ„Ÿåˆ°ç„¡å¥ˆã€‚é€™å‰‡æ–°èæœƒè®“é™¢é•·æ›´æœ‰ç†ç”±æ‹’çµ•æ”¶æ²»ï¼Œè®“é›‡ä¸»æ›´ä¸æƒ³åˆ†æ“”è²»ç”¨ã€‚', 'bg-blue-600')" class="flex items-center space-x-2 bg-blue-100 hover:bg-blue-200 text-blue-800 px-5 py-3 rounded-lg font-bold transition-colors w-full md:w-auto justify-center">
                        <span class="text-xl">ğŸ¤</span>
                        <span>è¨ªå•æ–½é†«å¸«ï¼šé†«é™¢å¾ˆé›£åšå—ï¼Ÿ</span>
                    </button>
                </div>

                <!-- å¡ç‰‡ 3 -->
                <div class="news-card bg-white border-t-8 border-yellow-500 p-8 rounded-lg shadow-md">
                    <div class="flex flex-col md:flex-row justify-between items-start mb-4">
                        <h3 class="text-2xl font-black text-gray-900 serif mb-2 md:mb-0 leading-normal">å‹å·¥æ€’å¼ï¼<br>å·¥æœƒæŠ—è­°ã€Œåå°å¼•é€²ç§»å·¥æ¶é£¯ç¢—ã€</h3>
                        <span class="bg-yellow-100 text-yellow-800 text-xs px-3 py-1 rounded-full font-bold">å‹å·¥ç‰ˆ</span>
                    </div>
                    <!-- æ¢å¾©å®Œæ•´çš„æ½¤é£¾å…§å®¹ï¼Œå¼·èª¿é–±è®€æ€§ -->
                    <div class="prose text-gray-800 mb-6 border-l-4 border-gray-100 pl-4">
                        <p class="mb-2"><strong>ã€æœ¬å ±è¨Šã€‘</strong>æ”¿åºœæœ€è¿‘æ‰“ç®—é–‹æ”¾è®“æ›´å¤šå¤–ç±ç§»å·¥é€²å…¥é£¯åº—æ¥­å’ŒæŠ€è¡“å·¥ä½œï¼Œå¼•ç™¼å°ç£å‹å·¥åœ˜é«”å¼·çƒˆåå½ˆï¼å³ä½¿æ”¿åºœæ‰¿è«¾ã€Œæœƒè¦æ±‚è€é—†å¹«å°ç£äººåŠ è–ªã€ï¼Œä½†è¨±å¤šå‹å·¥è¡¨ç¤ºä¸ç›¸ä¿¡ã€‚</p>
                        <p class="mb-1 font-bold text-gray-900">å‹å·¥åœ˜é«”åœ¨æ“”å¿ƒä»€éº¼ï¼Ÿå·¥æœƒä»£è¡¨æŒ‡å‡ºä¸‰å¤§å±æ©Ÿï¼š</p>
                        <ul class="list-disc pl-5 space-y-2 text-gray-700">
                            <li><strong>é£¯ç¢—è¢«æ¶èµ°ï¼š</strong>ç§»å·¥è–ªæ°´æ¯”è¼ƒä½ï¼Œè€é—†ç‚ºäº†çœæˆæœ¬ï¼Œä¸€å®šæœƒå„ªå…ˆè«‹ç§»å·¥ï¼Œå°ç£äººå°±æœƒé¢è‡¨å¤±æ¥­ã€‚</li>
                            <li><strong>è–ªæ°´æ¼²ä¸èµ·ä¾†ï¼š</strong>å¦‚æœæœ‰ä¾¿å®œçš„ç§»å·¥å¯ä»¥ç”¨ï¼Œè€é—†å°±ä¸éœ€è¦æé«˜è–ªæ°´ä¾†è«‹å°ç£äººï¼Œå°è‡´å°ç£å¹´è¼•äººçš„è–ªæ°´æ°¸é é€™éº¼ä½ã€‚</li>
                            <li><strong>åœ–åˆ©è€é—†ï¼š</strong>å‹å·¥åœ˜é«”æ‰¹è©•ï¼Œé€™å€‹æ”¿ç­–åªæ˜¯è®“è€é—†è³ºæ›´å¤šéŒ¢ï¼Œå»è®“å°ç£å‹å·¥é™·å…¥ç”Ÿå­˜å±æ©Ÿã€‚</li>
                        </ul>
                    </div>
                    <button onclick="openInterview('å·¥æœƒä»£è¡¨', 'å°ç£å¤–é€èˆ‡æœå‹™æ¥­ç”¢æ¥­å·¥æœƒä»£è¡¨ã€‚å¼·çƒˆåå°æ”¿åºœé–‹æ”¾ç§»å·¥é€²å…¥æœå‹™æ¥­ã€‚é€™å‰‡æ–°èæœƒè®“Uberå¤–é€å“¡ï¼ˆå¿—æ˜ï¼‰æ›´å …å®šåå°ã€Œæ‰“å·¥é‚„å‚µæ¢æ¬¾ã€ã€‚', 'bg-yellow-500')" class="flex items-center space-x-2 bg-yellow-100 hover:bg-yellow-200 text-yellow-800 px-5 py-3 rounded-lg font-bold transition-colors w-full md:w-auto justify-center">
                        <span class="text-xl">ğŸ¤</span>
                        <span>è¨ªå•å·¥æœƒä»£è¡¨ï¼šåœ¨æ°£ä»€éº¼ï¼Ÿ</span>
                    </button>
                </div>
            </div>
        </div>

        <!-- PAGE 3: å…¬è½æœƒé–‹å§‹ (åŠ‡æœ¬è¨ºæ–·) -->
        <div id="page3" class="page-content hidden">
            <div class="bg-green-50 border-l-4 border-green-600 p-4 mb-8 rounded-r-lg shadow-sm">
                <h3 class="font-bold text-green-900 text-lg mb-1">ğŸ“¢ å…¬è½æœƒé æ¼”ï¼ˆè˜‡æ ¼æ‹‰åº•å°è©±å®¤ï¼‰</h3>
                <p class="text-green-800">
                    é€™è£¡æœ‰ä½ã€Œè˜‡æ ¼æ‹‰åº•è€å¸«ã€æœƒå¹«ä½ çœ‹åŠ‡æœ¬ã€‚è«‹å°‡ä½ å¯«å¥½çš„åŠ‡æœ¬æ‰“å­—è²¼ä¸Šï¼Œæˆ–æ˜¯<strong>ç›´æ¥æ‹ç…§ä¸Šå‚³</strong>æ‰‹å¯«çš„å…§å®¹ã€‚<br>
                    æäº¤å¾Œï¼Œè€å¸«æœƒæå‡ºå•é¡Œï¼Œä½ å¯ä»¥åœ¨ä¸‹æ–¹å°è©±æ¡†å›æ‡‰è€å¸«ï¼Œä¸€èµ·æŠŠåŠ‡æœ¬ä¿®å¾—æ›´æ£’ï¼
                </p>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 h-[70vh]">
                <!-- å·¦å´ï¼šè¼¸å…¥å€ -->
                <div class="space-y-6 flex flex-col h-full">
                    <div class="bg-white p-6 rounded-xl shadow-md flex-grow overflow-y-auto">
                        <label class="block text-gray-700 font-bold mb-2">æ–¹å¼ä¸€ï¼šè¼¸å…¥åŠ‡æœ¬æ–‡å­—</label>
                        <textarea id="scriptText" class="w-full border border-gray-300 rounded-lg p-4 h-48 focus:outline-none focus:ring-2 focus:ring-green-500 resize-none mb-4" placeholder="è«‹å°‡ä½ å€‘å°çµ„è¨è«–å¥½çš„åŠ‡æœ¬å°è©±è²¼åœ¨é€™è£¡..."></textarea>
                        
                        <div class="relative flex items-center justify-center w-full mb-4">
                            <hr class="w-full border-gray-300">
                            <span class="absolute bg-white px-4 text-gray-500 text-sm">æˆ–æ˜¯</span>
                        </div>

                        <label class="block text-gray-700 font-bold mb-2">æ–¹å¼äºŒï¼šä¸Šå‚³æ‰‹å¯«åŠ‡æœ¬ç…§ç‰‡</label>
                        <div class="flex items-center justify-center w-full">
                            <label for="scriptImage" class="flex flex-col items-center justify-center w-full h-32 border-2 border-gray-300 border-dashed rounded-lg cursor-pointer bg-gray-50 hover:bg-gray-100 transition-colors">
                                <div class="flex flex-col items-center justify-center pt-5 pb-6">
                                    <svg class="w-8 h-8 mb-4 text-gray-500" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 20 16">
                                        <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 13h3a3 3 0 0 0 0-6h-.025A5.56 5.56 0 0 0 16 6.5 5.5 5.5 0 0 0 5.207 5.021C5.137 5.017 5.071 5 5 5a4 4 0 0 0 0 8h2.167M10 15V6m0 0L8 8m2-2 2 2"/>
                                    </svg>
                                    <p class="text-sm text-gray-500"><span class="font-semibold">é»æ“Šä¸Šå‚³</span> æˆ–æ‹–æ›³åœ–ç‰‡è‡³æ­¤</p>
                                    <p class="text-xs text-gray-500" id="fileNameDisplay">æ”¯æ´ JPG, PNG</p>
                                </div>
                                <input id="scriptImage" type="file" class="hidden" accept="image/*" onchange="handleFileSelect(this)" />
                            </label>
                        </div>

                        <button onclick="analyzeScript()" id="analyzeBtn" class="mt-6 w-full bg-green-600 hover:bg-green-700 text-white font-bold py-3 rounded-lg flex items-center justify-center transition-colors text-lg shadow-md">
                            <span>è«‹è€å¸«çµ¦å›é¥‹</span>
                        </button>
                    </div>
                </div>

                <!-- å³å´ï¼šå°è©±å€ (Chat Interface) -->
                <div class="bg-white rounded-xl shadow-md border border-gray-200 flex flex-col h-full overflow-hidden">
                    <div class="p-4 border-b border-gray-200 bg-gray-50 flex justify-between items-center">
                        <h3 class="font-bold text-gray-800 text-lg flex items-center">
                            <span class="text-2xl mr-2">ğŸ‘¨â€ğŸ«</span> è˜‡æ ¼æ‹‰åº•å°è©±å®¤
                        </h3>
                    </div>
                    
                    <!-- Chat Content -->
                    <div id="step3ChatArea" class="flex-grow p-4 overflow-y-auto space-y-4 bg-gray-50">
                        <div class="flex flex-col items-center justify-center h-full text-center opacity-60">
                            <span class="text-4xl mb-2">ğŸ“</span>
                            <p>è«‹åœ¨å·¦å´æäº¤åŠ‡æœ¬<br>è€å¸«æœƒåœ¨é€™è£¡è·Ÿä½ è¨è«–å–”ï¼</p>
                        </div>
                    </div>

                    <!-- Input Area (Hidden initially) -->
                    <div id="step3InputArea" class="p-3 border-t border-gray-200 bg-white hidden">
                        <div class="flex gap-2">
                            <input type="text" id="step3FollowUpInput" class="flex-grow border border-gray-300 rounded-lg p-2 focus:outline-none focus:ring-2 focus:ring-green-500" placeholder="å›æ‡‰è€å¸«æˆ–æå‡ºå•é¡Œ...">
                            <button onclick="submitStep3FollowUp()" class="bg-green-600 text-white px-4 py-2 rounded-lg font-bold hover:bg-green-700 transition-colors">é€å‡º</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </div>

    <!-- Modal for Interview (Shared) -->
    <div id="interviewModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50 p-4 backdrop-blur-sm">
        <div class="bg-white rounded-xl shadow-2xl w-full max-w-lg overflow-hidden transform transition-all scale-95 opacity-0 flex flex-col max-h-[90vh]" id="modalContent">
            <!-- Modal Header -->
            <div id="modalHeader" class="p-4 flex justify-between items-center text-white shrink-0">
                <h3 class="font-bold text-xl flex items-center">
                    <span class="text-2xl mr-2">ğŸ’¬</span> 
                    <span id="interviewRoleName">è§’è‰²åç¨±</span>
                </h3>
                <button onclick="closeInterview()" class="text-white hover:bg-white/20 rounded-full w-8 h-8 flex items-center justify-center text-xl font-bold transition-colors">&times;</button>
            </div>

            <!-- Modal Body -->
            <div class="p-6 flex flex-col flex-grow overflow-hidden bg-gray-50">
                <div class="mb-4 bg-white p-4 rounded-lg border border-gray-200 text-sm text-gray-600 shrink-0 shadow-sm">
                    <strong>è§’è‰²è¨­å®šï¼š</strong> <span id="interviewContext"></span>
                </div>

                <!-- Chat History -->
                <div id="chatHistory" class="space-y-4 mb-4 flex-grow overflow-y-auto hidden p-2">
                    <!-- Dynamic Content -->
                </div>

                <!-- Input Area -->
                <div class="space-y-3 shrink-0 bg-white p-3 rounded-xl border border-gray-200 shadow-sm">
                    <label class="block text-gray-700 font-bold text-sm mb-1">è«‹è¼¸å…¥ä½ çš„æå•ï¼š</label>
                    <textarea id="userQuestion" class="w-full border border-gray-300 rounded-lg p-3 focus:outline-none focus:ring-2 focus:ring-blue-500 h-20 resize-none text-sm" placeholder="ä¾‹å¦‚ï¼šä½ å°æ–¼ã€Œé»‘æˆ¶å¯¶å¯¶ã€æœ‰ä»€éº¼çœ‹æ³•ï¼Ÿåœ¨é€™æ¬¡å…¬è½æœƒä½ æœƒæ”¯æŒå“ªä¸€æ¢ï¼Ÿ"></textarea>
                    
                    <button onclick="submitQuestion()" id="sendBtn" class="w-full bg-gray-900 hover:bg-gray-800 text-white font-bold py-3 rounded-lg flex items-center justify-center transition-colors">
                        <span>é€å‡ºæå•</span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Settings Modal -->
    <div id="settingsModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50 p-4 backdrop-blur-sm">
        <div class="bg-white rounded-xl shadow-2xl w-full max-w-md overflow-hidden transform transition-all">
            <div class="p-4 bg-gray-800 text-white flex justify-between items-center">
                <h3 class="font-bold text-lg">âš™ï¸ è¨­å®š Google API Key</h3>
                <button onclick="closeSettings()" class="text-gray-300 hover:text-white">&times;</button>
            </div>
            <div class="p-6">
                <p class="text-sm text-gray-600 mb-4">
                    è«‹è¼¸å…¥æ‚¨çš„ Google Gemini API Key ä»¥å•Ÿç”¨ AI åŠŸèƒ½ã€‚<br>
                    <a href="https://aistudio.google.com/app/apikey" target="_blank" class="text-blue-600 hover:underline">å–å¾— API Key</a>
                </p>
                <!-- é è¨­é¡¯ç¤ºæœ‰ keyï¼Œä½†ä¹Ÿå…è¨±ä½¿ç”¨è€…è¦†è“‹ -->
                <input type="password" id="apiKeyInput" class="w-full border border-gray-300 rounded-lg p-3 focus:outline-none focus:ring-2 focus:ring-blue-500 mb-4" placeholder="è²¼ä¸Šæ‚¨çš„ API Key (è‹¥å·²é è¨­å¯ç•™ç©º)">
                <div class="flex justify-end space-x-2">
                    <button onclick="closeSettings()" class="px-4 py-2 text-gray-600 hover:bg-gray-100 rounded-lg">å–æ¶ˆ</button>
                    <button onclick="saveApiKey()" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">å„²å­˜</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // -----------------------------------------------------------
        // ğŸ”‘ API Key è¨­å®š
        // -----------------------------------------------------------
        const DEFAULT_API_KEY = "AIzaSyBh9bUjAg-xFvi82FEdh_lVpaIf3KthkGg";

        let voices = [];
        let isPaused = false;

        // åˆå§‹åŒ–èªéŸ³
        function initVoices() {
            const available = window.speechSynthesis.getVoices();
            if (available.length > 0) {
                voices = available;
            } else {
                window.speechSynthesis.onvoiceschanged = () => {
                    voices = window.speechSynthesis.getVoices();
                };
            }
        }
        initVoices();

        function getApiKey() {
            // å„ªå…ˆä½¿ç”¨ä½¿ç”¨è€…æ‰‹å‹•è¼¸å…¥çš„ keyï¼Œå¦‚æœæ²’æœ‰å‰‡ä½¿ç”¨é è¨­ key
            return localStorage.getItem('gemini_api_key') || DEFAULT_API_KEY;
        }

        // Settings Modal
        function openSettings() {
            document.getElementById('settingsModal').classList.remove('hidden');
            document.getElementById('settingsModal').classList.add('flex');
            const storedKey = localStorage.getItem('gemini_api_key');
            if (storedKey) {
                document.getElementById('apiKeyInput').value = storedKey;
            }
        }

        function closeSettings() {
            document.getElementById('settingsModal').classList.add('hidden');
            document.getElementById('settingsModal').classList.remove('flex');
        }

        function saveApiKey() {
            const key = document.getElementById('apiKeyInput').value.trim();
            if (key) {
                localStorage.setItem('gemini_api_key', key);
                alert('API Key å·²å„²å­˜ï¼ç³»çµ±å°‡å„ªå…ˆä½¿ç”¨æ‚¨è¼¸å…¥çš„é‡‘é‘°ã€‚');
            } else {
                localStorage.removeItem('gemini_api_key');
                alert('å·²æ¸…é™¤è‡ªè¨‚é‡‘é‘°ï¼Œç³»çµ±å°‡æ¢å¾©ä½¿ç”¨é è¨­é‡‘é‘°ã€‚');
            }
            closeSettings();
        }

        // åˆ‡æ›é é¢åŠŸèƒ½
        function switchPage(pageId) {
            document.getElementById('page1').classList.add('hidden');
            document.getElementById('page2').classList.add('hidden');
            document.getElementById('page3').classList.add('hidden');
            
            document.getElementById('btn-page1').classList.remove('active');
            document.getElementById('btn-page2').classList.remove('active');
            document.getElementById('btn-page3').classList.remove('active');
            
            document.getElementById(pageId).classList.remove('hidden');
            document.getElementById('btn-' + pageId).classList.add('active');
        }

        // æ–‡ä»¶ä¸Šå‚³è™•ç†
        let selectedImageBase64 = null;

        function handleFileSelect(input) {
            const file = input.files[0];
            const display = document.getElementById('fileNameDisplay');
            
            if (file) {
                display.textContent = `å·²é¸æ“‡æª”æ¡ˆï¼š${file.name}`;
                display.classList.add('text-green-600', 'font-bold');
                
                const reader = new FileReader();
                reader.onload = function(e) {
                    // Remove data url prefix (e.g., "data:image/jpeg;base64,")
                    selectedImageBase64 = e.target.result.split(',')[1];
                    const mimeType = e.target.result.split(';')[0].split(':')[1];
                    window.currentImageMimeType = mimeType;
                };
                reader.readAsDataURL(file);
            } else {
                display.textContent = "æ”¯æ´ JPG, PNG";
                display.classList.remove('text-green-600', 'font-bold');
                selectedImageBase64 = null;
            }
        }

        // è³‡æ–™åº« 1ï¼šå…«ä»½èƒŒæ™¯æ–‡æœ¬è³‡æ–™
        const globalDocsData = `
        ã€èƒŒæ™¯è„ˆçµ¡ï¼šç§»å·¥åœ¨å°è™•å¢ƒã€‘
        1. ç§»å·¥åˆ†é¡èˆ‡æ³•è¦ï¼šç¤¾ç¦ç§»å·¥ï¼ˆçœ‹è­·ï¼Œç„¡å‹åŸºæ³•ï¼‰èˆ‡ç”¢æ¥­ç§»å·¥ï¼ˆå·¥å» /æ¼å·¥ï¼Œæœ‰å‹åŸºæ³•ï¼‰ã€‚
        2. é€ƒè·‘åŸå› ï¼šè–ªæ°´å¤ªä½ã€å·¥æ™‚å¤ªé•·ã€ä»²ä»‹è²»é«˜ã€è¢«è™å¾…ã€ç„¡æ³•è‡ªç”±è½‰æ›é›‡ä¸»ã€‚
        3. é»‘æˆ¶å¯¶å¯¶ï¼šå¤±è¯å¥³ç§»å·¥æ‡·å­•ä¸æ•¢å°±é†«ï¼Œå­©å­ç„¡èº«åˆ†ã€ç„¡å¥ä¿ã€ç„¡ç–«è‹—ï¼Œæ“”å¿ƒè¢«é£è¿”ã€‚
        4. é†«ç™‚å›°å¢ƒï¼šå¤±è¯ç§»å·¥ç„¡å¥ä¿ï¼Œç”Ÿç—…ä¸æ•¢å°±é†«ï¼ˆæ€•è¢«æŠ“ï¼‰ï¼Œå°è‡´å°ç—…è®Šå¤§ç—…ï¼Œæˆ–å°‹æ±‚å¯†é†«ã€‚
        5. ç¤¾æœƒè§€æ„Ÿï¼šéƒ¨åˆ†å°ç£äººæœ‰ç›¸å°å‰å¥ªæ„Ÿï¼Œèªç‚ºç§»å·¥æ¶å·¥ä½œã€æ²»å®‰è®Šå·®ï¼›ä¹Ÿæœ‰ã€Œé¸æ“‡æ€§å‹å–„ã€ã€‚
        6. åˆ¶åº¦çŸ›ç›¾ï¼šç¼ºå·¥éœ€è¦ç§»å·¥ï¼Œä½†åˆæ€•è¡æ“Šæœ¬åœ‹å°±æ¥­ï¼›éœ€è¦é†«ç™‚äººæ¬Šï¼Œä½†é†«é™¢æ€•å‘†å¸³ã€‚
        `;

        // è³‡æ–™åº« 2ï¼šåŠ‡æœ¬ä»»å‹™èˆ‡å…«ä½è§’è‰²è©³ç´°è¨­å®š
        const scenarioRolesData = `
        ã€åŠ‡æœ¬ä»»å‹™ï¼šåœ“æ¡Œæœƒè­°åŠ‡æœ¬æ’°å¯«ã€‘
        å‘½é¡Œï¼šã€Œç§»å·¥å®‰å¿ƒé†«ç™‚å¡ã€è©¦è¾¦å…¬è½æœƒã€‚
        æ ¸å¿ƒçˆ­è­°æ¢æ¬¾ï¼š
        1. å…¨æ°‘ä»£å¢Šæ¢æ¬¾ï¼šé†«ç™‚è²»ç”¨ç”±æ”¿åºœç¨…æ”¶åŠé›‡ä¸»å…ˆä»£å¢Šã€‚
        2. æ•‘äººä¸æŠ“äººæ¢æ¬¾ï¼šæŒå¡å°±é†«ï¼Œé†«é™¢çµ•å°ä¸èƒ½æ´©æ¼èº«åˆ†ï¼Œä¸”çµ•å°ä¸èƒ½é€šå ±è­¦å¯Ÿã€‚
        3. æ‰“å·¥é‚„å‚µæ¢æ¬¾ï¼šç‚ºå„Ÿé‚„é†«ç™‚è²»ï¼Œå…è¨±æŒã€Œè‡¨æ™‚å·¥ä½œè­‰ã€è‡ªç”±ä¸”åˆæ³•åœ¨è‡ºç£é¸æ“‡å·¥ä½œã€‚

        ã€å…«ä½è§’è‰²è©³ç´°è¨­å®šã€‘
        1. è¶Šå—å¯†é†« èŒƒé†«å¸«ï¼šè¶Šå—é†«å¸«åˆ°å°ç£åšæ¸…æ½”å·¥ï¼Œé•æ³•å¹«å¤–ç±ç§»å·¥é€²è¡Œé†«ç™‚ã€‚
        2. å¤±è¯ç§»å·¥ é˜¿é€¸ï¼šå·¥å‚·å»ä¸æ•¢å°±é†«çš„é€ƒè·‘ç§»å·¥ï¼Œä¾é ç¤¾å·¥èˆ‡ç¤¾æœƒè³‡æºå”åŠ©ï¼ˆæ¢æ¬¾ç•¶äº‹äººï¼‰ã€‚
        3. å¸‚ç«‹é†«é™¢ é™¢é•·ï¼šåŒæ™‚é¢å°è¨ºé–“å…§é‡å‚·çš„é€ƒè·‘ç§»å·¥ï¼ŒåŠæœªè¢«ä»˜æ¸…çš„é¾å¤§å‘†å¸³ã€‚
        4. å®¶åº­ç…§è­·é›‡ä¸»ï¼šä¾ç…§åˆæ³•ç¨‹åºé›‡ç”¨å¤–ç±ç§»å·¥ï¼Œç…§é¡§å®¶ä¸­å‚·ç—…é•·è¼©ã€‚
        5. ç«‹æ³•å§”å“¡ è˜‡ç«‹å§”ï¼šè³ªè©¢å‹å‹•éƒ¨é•·æ™‚ï¼Œæå‡ºã€Œè‡ºç£äººæ€æœƒå¹«å¤–ç±æ¼å·¥é€uberã€çš„ç™¼ç¾ã€‚
        6. å‚³çµ±å·¥å» è€é—†ï¼šä»¥è¼ƒé«˜è–ªæ°´ç§ä¸‹é›‡ç”¨é€ƒè·‘ç§»å·¥ï¼Œä½†å‹å·¥ç„¡æ³•ä½¿ç”¨å‹å¥ä¿ã€‚
        7. è‡ºç£Uberå¤–é€å“¡ï¼šæ“”å¿ƒè¶Šä¾†è¶Šå¤šå¤–ç±ç§»å·¥å’Œè‡ªå·±ä¸€æ¨£è·‘å¤–é€ã€‚
        8. å‹å‹•éƒ¨é•·ï¼šåš´æ ¼åŸ·è¡Œã€Šå‹åŸºæ³•ã€‹å’Œã€Šå°±æ¥­æœå‹™æ³•ã€‹è¦å®šã€‚
        `;

        // è³‡æ–™åº« 3ï¼šè§’è‰²é—œä¿‚çŸ©é™£ (Inter-role Relationships)
        const relationshipMatrix = `
        ã€è§’è‰²é—œä¿‚æ„è­˜ (Inter-role Awareness)ã€‘
        1. èŒƒé†«å¸« (å¯†é†«)ï¼š
           - vs è˜‡ç«‹å§”/å‹å‹•éƒ¨é•·ï¼šæ„Ÿåˆ°è¢«å£“è¿«ï¼Œèªç‚ºæ³•å¾‹ä¸é€šäººæƒ…ã€‚
           - vs é˜¿é€¸ï¼šåŒç—…ç›¸æ†ï¼Œæƒ³å¹«åŠ©åŒé„‰ã€‚
        2. é˜¿é€¸ (å¤±è¯ç§»å·¥)ï¼š
           - vs å‚³çµ±è€é—†ï¼šæ—¢ä¾è³´è€é—†çµ¦å·¥ä½œï¼Œåˆæ€•è¢«è€é—†å‰å‰Šæˆ–èˆ‰å ±ã€‚
           - vs å‹å‹•éƒ¨é•·ï¼šæ¥µåº¦ææ‡¼ï¼Œçœ‹åˆ°éƒ¨é•·å°±åƒçœ‹åˆ°è­¦å¯Ÿã€‚
        3. å‚³çµ±å·¥å» è€é—†ï¼š
           - vs å‹å‹•éƒ¨é•·ï¼šèªç‚ºæ”¿åºœæ³•è¦å¤ªæ­»æ¿ï¼Œå®³ä»–è«‹ä¸åˆ°äººã€‚
           - vs è˜‡ç«‹å§”ï¼šè¨å­ç«‹å§”åªæœƒä½œç§€ï¼Œä¸äº†è§£ä¸­å°ä¼æ¥­çš„è‹¦ã€‚
           - vs é˜¿é€¸ï¼šæŠŠé˜¿é€¸ç•¶å·¥å…·äººï¼Œä½†ä¹Ÿè¨±æœ‰ä¸€çµ²åŒæƒ…ï¼ˆå› ç‚ºé˜¿é€¸å¹«ä»–è³ºéŒ¢ï¼‰ã€‚
        4. å®¶åº­ç…§è­·é›‡ä¸»ï¼š
           - vs å‚³çµ±è€é—†ï¼šè¦ºå¾—è€é—†ç§è˜é»‘å·¥å®³åˆæ³•é›‡ä¸»è¢«åŠ æ”¶å®‰å®šè²»ï¼Œå¾ˆä¸å…¬å¹³ã€‚
           - vs å‹å‹•éƒ¨é•·ï¼šæŠ±æ€¨ç”³è«‹ç§»å·¥æ‰‹çºŒå¤ªæ…¢å¤ªè²´ã€‚
        5. è˜‡ç«‹å§”ï¼š
           - vs å‹å‹•éƒ¨é•·ï¼šç›£ç£è€…ï¼Œç¶“å¸¸è³ªè©¢éƒ¨é•·åŸ·æ³•ä¸åŠ›ã€‚
           - vs Uberå¤–é€å“¡ï¼šç«™åœ¨ä¿è­·æœ¬å‹ç«‹å ´ï¼Œè¦–å¤–é€å“¡ç‚ºé¸ç¥¨ä¾†æºã€‚
        6. Uberå¤–é€å“¡ï¼š
           - vs é˜¿é€¸/ç§»å·¥ï¼šè¦–ç‚ºæ¶é£¯ç¢—çš„æ•µäººï¼Œæœ‰å¼·çƒˆç›¸å°å‰å¥ªæ„Ÿã€‚
           - vs è˜‡ç«‹å§”ï¼šæœŸå¾…ç«‹å§”å¹«å¿™ç™¼è²ã€‚
        7. å¸‚ç«‹é†«é™¢é™¢é•·ï¼š
           - vs å‹å‹•éƒ¨é•·/è˜‡ç«‹å§”ï¼šåªåœ¨ä¹èª°ä¾†ä»˜å‘†å¸³ï¼Œå°æ”¿æ²»é¬¥çˆ­æ²’èˆˆè¶£ã€‚
           - vs é›‡ä¸»ï¼šèªç‚ºé›‡ä¸»æ‡‰è©²å¤šä»˜é»éŒ¢ã€‚
        8. å‹å‹•éƒ¨é•·ï¼š
           - vs è˜‡ç«‹å§”ï¼šå£“åŠ›ä¾†æºï¼Œæ€•è¢«è³ªè©¢ã€‚
           - vs ç§»å·¥ï¼šä¾æ³•å¿…é ˆæŠ“ï¼Œä½†äººé“ä¸Šåˆæƒ³å¹«ï¼Œè™•æ–¼å…©é›£ã€‚
        `;

        let currentRole = "";
        let currentContext = "";
        let step3History = []; 
        let currentUtterance = null; 
        // let isPaused = false; // å·²åœ¨ä¸Šæ–¹å®£å‘Š

        // ---- æ–‡æœ¬æ ¼å¼åŒ–èˆ‡æ¸…ç† ----
        function formatAIResponse(text) {
            // å°‡ **æ–‡å­—** æ›¿æ›ç‚º <strong class="text-red-600 font-bold">æ–‡å­—</strong>
            let formatted = text.replace(/\*\*(.*?)\*\*/g, '<strong class="text-red-600 font-bold">$1</strong>');
            formatted = formatted.replace(/\n/g, '<br>');
            return formatted;
        }

        function cleanForSpeech(text) {
            // ç§»é™¤ markdown ç¬¦è™Ÿï¼Œä¿ç•™æ–‡å­—å…§å®¹ä¾›èªéŸ³æœ—è®€
            return text.replace(/\*/g, '').replace(/\n/g, ' ').replace(/'/g, "\\'");
        }

        // ---- TTS èªéŸ³æ’­æ”¾åŠŸèƒ½ (Advanced & Pause/Resume) ----
        function speak(text, roleName, btnElement) {
            // å¦‚æœç•¶å‰æ­£åœ¨æ’­æ”¾ä¸”æ˜¯åŒä¸€å€‹æŒ‰éˆ•
            if (window.speechSynthesis.speaking && btnElement.classList.contains('playing')) {
                if (isPaused) {
                    window.speechSynthesis.resume();
                    isPaused = false;
                    btnElement.innerHTML = getPauseIcon(); 
                } else {
                    window.speechSynthesis.pause();
                    isPaused = true;
                    btnElement.innerHTML = getPlayIcon(); 
                }
                return;
            }

            // åœæ­¢èˆŠçš„æ’­æ”¾
            window.speechSynthesis.cancel();
            resetAllAudioButtons(); 
            isPaused = false;

            const utterance = new SpeechSynthesisUtterance(text);
            utterance.lang = 'zh-TW';
            
            // è§’è‰²è²éŸ³è¨­å®š (Gender & Tone Simulation)
            let rate = 1.0; 
            let pitch = 1.0;
            let targetGender = 'female'; 

            if (roleName) {
                if (roleName.includes('èŒƒé†«å¸«') || roleName.includes('é˜¿é€¸') || roleName.includes('è˜‡ç«‹å§”') || roleName.includes('å·¥å» è€é—†') || roleName.includes('è˜‡æ ¼æ‹‰åº•')) {
                    targetGender = 'male';
                } else {
                    targetGender = 'female';
                }
            }

            // å°‹æ‰¾é©åˆçš„ä¸­æ–‡èªéŸ³
            let chosenVoice = null;
            const zhVoices = voices.filter(v => v.lang.includes('zh') || v.lang.includes('ZH'));
            
            if (zhVoices.length > 0) {
                if (targetGender === 'male') {
                    chosenVoice = zhVoices.find(v => v.name.includes('Male') || v.name.includes('Danny') || v.name.includes('Zhiwei') || v.name.includes('Qiang'));
                } else {
                    chosenVoice = zhVoices.find(v => v.name.includes('Female') || v.name.includes('Ting-Ting') || v.name.includes('Mei-Jia') || v.name.includes('Hanhan') || v.name.includes('Yating'));
                }
                if (!chosenVoice) chosenVoice = zhVoices[0];
            }

            if (chosenVoice) utterance.voice = chosenVoice;

            // éŸ³é«˜èˆ‡èªé€Ÿå¾®èª¿
            if (targetGender === 'male') {
                if (chosenVoice && !chosenVoice.name.includes('Male') && !chosenVoice.name.includes('Zhiwei')) {
                    pitch = 0.6; // å¼·åˆ¶å£“ä½å¥³è²æ¨¡æ“¬ç”·è²
                }
                if (roleName.includes('é˜¿é€¸')) { rate = 0.8; pitch *= 0.9; } 
                else if (roleName.includes('è€é—†')) { rate = 1.1; pitch *= 0.9; } 
                else if (roleName.includes('è˜‡ç«‹å§”')) { rate = 1.2; pitch *= 1.0; }
            } else {
                pitch = 1.1; 
                if (roleName.includes('å¤–é€å“¡')) { rate = 1.2; } 
                else if (roleName.includes('éƒ¨é•·') || roleName.includes('é™¢é•·')) { rate = 0.95; pitch = 1.0; } 
            }

            utterance.rate = rate;
            utterance.pitch = pitch;

            utterance.onend = () => {
                btnElement.classList.remove('playing');
                btnElement.innerHTML = getPlayIcon();
                isPaused = false;
            };

            window.speechSynthesis.speak(utterance);
            btnElement.classList.add('playing');
            btnElement.innerHTML = getPauseIcon();
        }

        function getPlayIcon() {
            return `<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5"><path stroke-linecap="round" stroke-linejoin="round" d="M19.114 5.636a9 9 0 010 12.728M16.463 8.288a5.25 5.25 0 010 7.424M6.75 8.25l4.72-4.72a.75.75 0 011.28.53v15.88a.75.75 0 01-1.28.53l-4.72-4.72H4.51c-.88 0-1.704-.507-1.938-1.354A9.01 9.01 0 012.25 12c0-.83.112-1.633.322-2.396C2.806 8.756 3.63 8.25 4.51 8.25H6.75z" /></svg>`;
        }

        function getPauseIcon() {
            return `<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 5.25v13.5m-7.5-13.5v13.5" /></svg>`;
        }

        function resetAllAudioButtons() {
            const buttons = document.querySelectorAll('button[title="æ’­æ”¾èªéŸ³"]');
            buttons.forEach(btn => {
                btn.classList.remove('playing');
                btn.innerHTML = getPlayIcon();
            });
        }

        // ---- AI åŠ‡æœ¬åˆ†æåŠŸèƒ½ (Step 3 - Socratic Chat) ----
        async function analyzeScript() {
            const apiKey = getApiKey();
            if (!apiKey) { alert("è«‹æª¢æŸ¥ API Keyï¼"); return; }

            const textInput = document.getElementById('scriptText').value.trim();
            const analyzeBtn = document.getElementById('analyzeBtn');
            const chatArea = document.getElementById('step3ChatArea');
            const inputArea = document.getElementById('step3InputArea');

            if (!textInput && !selectedImageBase64) {
                alert("è«‹è¼¸å…¥æ–‡å­—æˆ–ä¸Šå‚³åœ–ç‰‡ï¼");
                return;
            }

            analyzeBtn.disabled = true;
            analyzeBtn.innerText = 'è€å¸«æ€è€ƒä¸­...';
            chatArea.innerHTML = `<div class="flex justify-center"><div class="loader"></div></div>`;

            const contentParts = [];
            let userMsg = "é€™æ˜¯æˆ‘å€‘å°çµ„çš„åŠ‡æœ¬ï¼š\n";
            if (textInput) {
                userMsg += textInput;
                contentParts.push({ text: `é€™æ˜¯å­¸ç”Ÿçš„åŠ‡æœ¬æ–‡å­—ï¼š\n${textInput}` });
            }
            if (selectedImageBase64) {
                userMsg += "[å·²ä¸Šå‚³åŠ‡æœ¬åœ–ç‰‡]";
                contentParts.push({ text: "é€™æ˜¯å­¸ç”Ÿä¸Šå‚³çš„åŠ‡æœ¬åœ–ç‰‡ï¼ˆå¯èƒ½æ˜¯æ‰‹å¯«ç¨¿ï¼‰ï¼š" });
                contentParts.push({
                    inlineData: {
                        mimeType: window.currentImageMimeType || "image/jpeg",
                        data: selectedImageBase64
                    }
                });
            }

            step3History = [
                { role: "user", parts: contentParts }
            ];

            try {
                const systemPrompt = `ä½ æ˜¯åœ‹å°äº”å¹´ç´šçš„ã€Œè˜‡æ ¼æ‹‰åº•å¼å¼•å°è€å¸«ã€ã€‚
                ã€ä»»å‹™ã€‘é–±è®€åŠ‡æœ¬ï¼Œé€²è¡Œå°è©±å¼å¼•å°ã€‚
                ã€åŸå‰‡ã€‘
                1. **æ¥µåº¦ç°¡æ½”**ï¼šå›æ‡‰æ§åˆ¶åœ¨ 100 å­—å…§ã€‚
                2. **ç¦æ­¢è¼¸å‡ºçµ±è¨ˆæ•¸æ“š**ã€‚
                3. **çµæ§‹**ï¼šä¸€å€‹è®šç¾ + ä¸€å€‹æŒ‘æˆ°æ€§æå•ã€‚
                4. **èªæ°£**ï¼šè¦ªåˆ‡ã€å¥½å¥‡ã€‚
                5. **ç¦æ­¢**ï¼šçµ•ä¸ç›´æ¥å¹«å¯«åŠ‡æœ¬ã€‚`;

                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        contents: step3History,
                        systemInstruction: { parts: [{ text: systemPrompt }] }
                    })
                });

                const data = await response.json();
                if (data.error) throw new Error(data.error.message);

                const aiText = data.candidates[0].content.parts[0].text;
                step3History.push({ role: "model", parts: [{ text: aiText }] });

                const displayText = formatAIResponse(aiText);
                const speechText = cleanForSpeech(aiText);

                chatArea.innerHTML = `
                    <div class="flex justify-end mb-4">
                        <div class="bg-gray-200 rounded-lg py-2 px-4 max-w-[80%] text-sm text-gray-700">
                            ${userMsg.replace(/\n/g, '<br>')}
                        </div>
                    </div>
                    <div class="flex justify-start mb-4 items-start">
                        <div class="w-8 h-8 rounded-full bg-green-100 flex items-center justify-center text-lg mr-2 flex-shrink-0">ğŸ‘¨â€ğŸ«</div>
                        <div class="bg-green-50 border border-green-200 rounded-lg py-3 px-4 max-w-[90%] text-sm text-gray-800 shadow-sm relative group">
                            <div class="font-bold text-xs text-green-700 mb-1">è˜‡æ ¼æ‹‰åº•è€å¸«</div>
                            ${displayText}
                            <button onclick="speak('${speechText}', 'è˜‡æ ¼æ‹‰åº•è€å¸«', this)" class="absolute -right-8 top-2 text-gray-400 hover:text-green-600 transition-colors" title="æ’­æ”¾èªéŸ³">
                                ${getPlayIcon()}
                            </button>
                        </div>
                    </div>
                `;
                inputArea.classList.remove('hidden');
                
            } catch (error) {
                console.error(error);
                chatArea.innerHTML = `<div class="text-red-500 text-center text-sm">é€£ç·šéŒ¯èª¤ï¼Œè«‹é‡è©¦ã€‚</div>`;
            } finally {
                analyzeBtn.disabled = false;
                analyzeBtn.innerText = 'é‡æ–°æäº¤';
            }
        }

        async function submitStep3FollowUp() {
            const apiKey = getApiKey();
            const inputField = document.getElementById('step3FollowUpInput');
            const userText = inputField.value.trim();
            if (!userText) return;

            const chatArea = document.getElementById('step3ChatArea');
            chatArea.innerHTML += `
                <div class="flex justify-end mb-4">
                    <div class="bg-gray-800 text-white rounded-lg py-2 px-4 max-w-[80%] text-sm">
                        ${userText}
                    </div>
                </div>
            `;
            chatArea.scrollTop = chatArea.scrollHeight;
            inputField.value = '';
            inputField.disabled = true;

            step3History.push({ role: "user", parts: [{ text: userText }] });

            try {
                const systemPrompt = `ä½ æ˜¯åœ‹å°äº”å¹´ç´šçš„ã€Œè˜‡æ ¼æ‹‰åº•å¼å¼•å°è€å¸«ã€ã€‚
                ã€ä»»å‹™ã€‘é‡å°å­¸ç”Ÿçš„å›æ‡‰ç¹¼çºŒè¿½å•ã€‚
                ã€çŸ¥è­˜åº«ã€‘${globalDocsData} ${scenarioRolesData} ${relationshipMatrix}
                ã€åŸå‰‡ã€‘1.æ¥µç°¡(100å­—å…§)ã€‚2.çµæ§‹ï¼šè‚¯å®š+è¿½å•ã€‚3.èªæ°£è¦ªåˆ‡ã€‚4.ä¸çµ¦ç­”æ¡ˆã€‚5.ç¦æ­¢å­—æ•¸çµ±è¨ˆã€‚`;

                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        contents: step3History,
                        systemInstruction: { parts: [{ text: systemPrompt }] }
                    })
                });

                const data = await response.json();
                const aiText = data.candidates[0].content.parts[0].text;
                step3History.push({ role: "model", parts: [{ text: aiText }] });

                const displayText = formatAIResponse(aiText);
                const speechText = cleanForSpeech(aiText);

                chatArea.innerHTML += `
                    <div class="flex justify-start mb-4 items-start">
                        <div class="w-8 h-8 rounded-full bg-green-100 flex items-center justify-center text-lg mr-2 flex-shrink-0">ğŸ‘¨â€ğŸ«</div>
                        <div class="bg-green-50 border border-green-200 rounded-lg py-3 px-4 max-w-[90%] text-sm text-gray-800 shadow-sm relative group">
                            <div class="font-bold text-xs text-green-700 mb-1">è˜‡æ ¼æ‹‰åº•è€å¸«</div>
                            ${displayText}
                            <button onclick="speak('${speechText}', 'è˜‡æ ¼æ‹‰åº•è€å¸«', this)" class="absolute -right-8 top-2 text-gray-400 hover:text-green-600 transition-colors" title="æ’­æ”¾èªéŸ³">
                                ${getPlayIcon()}
                            </button>
                        </div>
                    </div>
                `;
                chatArea.scrollTop = chatArea.scrollHeight;

            } catch (error) {
                console.error(error);
                chatArea.innerHTML += `<div class="text-red-500 text-sm mb-4">è€å¸«å¥½åƒç¡è‘—äº†...è«‹å†è©¦ä¸€æ¬¡ã€‚</div>`;
            } finally {
                inputField.disabled = false;
                inputField.focus();
            }
        }

        // ---- æ—¢æœ‰çš„è§’è‰²è¨ªå•åŠŸèƒ½ (Step 1 & 2) ----
        function openInterview(role, context, colorClass) {
            currentRole = role;
            currentContext = context;
            
            const header = document.getElementById('modalHeader');
            header.className = `p-4 flex justify-between items-center text-white shrink-0 ${colorClass.replace('bg-', 'bg-').replace('100', '600')}`; 
            
            if (colorClass.includes('slate')) header.className = `p-4 flex justify-between items-center text-white shrink-0 bg-slate-700`;
            if (colorClass.includes('red')) header.className = `p-4 flex justify-between items-center text-white shrink-0 bg-red-600`;
            if (colorClass.includes('blue')) header.className = `p-4 flex justify-between items-center text-white shrink-0 bg-blue-600`;
            if (colorClass.includes('yellow')) header.className = `p-4 flex justify-between items-center text-white shrink-0 bg-yellow-600`;
            if (colorClass.includes('orange')) header.className = `p-4 flex justify-between items-center text-white shrink-0 bg-orange-500`;

            document.getElementById('userQuestion').value = "";
            document.getElementById('chatHistory').innerHTML = "";
            document.getElementById('chatHistory').classList.add('hidden');
            
            const modal = document.getElementById('interviewModal');
            const content = document.getElementById('modalContent');
            modal.classList.remove('hidden');
            modal.classList.add('flex');
            
            setTimeout(() => {
                content.classList.remove('scale-95', 'opacity-0');
                content.classList.add('scale-100', 'opacity-100');
            }, 10);
        }

        function closeInterview() {
            window.speechSynthesis.cancel(); // é—œé–‰è¦–çª—æ™‚åœæ­¢æ’­æ”¾
            const modal = document.getElementById('interviewModal');
            const content = document.getElementById('modalContent');
            
            content.classList.remove('scale-100', 'opacity-100');
            content.classList.add('scale-95', 'opacity-0');
            
            setTimeout(() => {
                modal.classList.remove('flex');
                modal.classList.add('hidden');
            }, 200);
        }

        async function submitQuestion() {
            const apiKey = getApiKey();
            const question = document.getElementById('userQuestion').value.trim();
            if (!question) return;

            const chatHistory = document.getElementById('chatHistory');
            const sendBtn = document.getElementById('sendBtn');
            const userQuestionInput = document.getElementById('userQuestion');

            sendBtn.disabled = true;
            sendBtn.innerHTML = '<div class="loader"></div>';
            userQuestionInput.disabled = true;
            
            chatHistory.classList.remove('hidden');
            chatHistory.innerHTML += `
                <div class="flex justify-end">
                    <div class="bg-gray-800 text-white rounded-lg py-2 px-4 max-w-[85%] rounded-tr-none text-right shadow-sm text-sm">
                        ${question}
                    </div>
                </div>
            `;
            chatHistory.scrollTop = chatHistory.scrollHeight;

            try {
                // Prompt: è§’è‰²è¨ªå• (é‡å°å°äº”å„ªåŒ– + ç¦æ­¢çµ±è¨ˆ + è§’è‰²é—œä¿‚æ„è­˜)
                const systemPrompt = `ä½ ç¾åœ¨è¦æ‰®æ¼”ä¸€ä½åœ‹å°ç¤¾æœƒç§‘æ•™æ¡ˆä¸­çš„äººç‰©ï¼š${currentRole}ã€‚
                ã€è¨­å®šã€‘${currentContext}
                ã€çŸ¥è­˜ã€‘${globalDocsData}
                ã€æƒ…å¢ƒã€‘${scenarioRolesData}
                ã€è§’è‰²é—œä¿‚çŸ©é™£ã€‘${relationshipMatrix} 

                ã€åŸå‰‡ã€‘
                1. **æ¥µåº¦ç°¡æ½”**ï¼š100å­—å…§ã€‚
                2. **ç¦æ­¢è¼¸å‡ºçµ±è¨ˆæ•¸æ“š**ã€‚
                3. **é‡å°æ€§**ï¼šåªå›ç­”å•é¡Œï¼Œåå•å¼•å°æ€è€ƒã€‚
                4. **èªæ°£**ï¼šç”Ÿå‹•ã€ç¬¦åˆè§’è‰²ï¼ˆå¦‚æ¿€å‹•ã€ç„¡å¥ˆï¼‰ã€‚`;

                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        contents: [{ parts: [{ text: `å­¸ç”Ÿå•ï¼š${question}` }] }],
                        systemInstruction: { parts: [{ text: systemPrompt }] }
                    })
                });

                const data = await response.json();
                if (data.error) throw new Error(data.error.message);

                const aiText = data.candidates[0].content.parts[0].text;

                const displayText = formatAIResponse(aiText);
                const speechText = cleanForSpeech(aiText);

                chatHistory.innerHTML += `
                    <div class="flex justify-start relative group">
                        <div class="bg-white border border-gray-200 text-gray-800 rounded-lg py-3 px-4 max-w-[90%] rounded-tl-none shadow-sm text-sm">
                            <div class="font-bold text-xs text-blue-600 mb-1">${currentRole} èªªï¼š</div>
                            ${displayText}
                        </div>
                        <button onclick="speak('${speechText}', '${currentRole}', this)" class="ml-2 text-gray-400 hover:text-blue-600 transition-colors self-center" title="æ’­æ”¾èªéŸ³">
                            ${getPlayIcon()}
                        </button>
                    </div>
                `;

            } catch (error) {
                console.error("API Error:", error);
                chatHistory.innerHTML += `
                    <div class="flex justify-start">
                        <div class="bg-red-50 border border-red-100 text-red-800 rounded-lg py-2 px-4 max-w-[90%] text-sm">
                            é€£ç·šéŒ¯èª¤ï¼Œè«‹ç¨å¾Œå†è©¦ã€‚
                        </div>
                    </div>
                `;
            } finally {
                sendBtn.disabled = false;
                sendBtn.innerHTML = '<span>é€å‡ºæå•</span>';
                userQuestionInput.disabled = false;
                userQuestionInput.value = "";
                userQuestionInput.focus();
                chatHistory.scrollTop = chatHistory.scrollHeight;
            }
        }
    </script>
</body>
</html>
